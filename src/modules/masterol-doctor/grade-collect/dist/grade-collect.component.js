"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
exports.__esModule = true;
exports.GradeCollectComponent = void 0;
var core_1 = require("@angular/core");
var Parse = require("parse");
var GradeCollectComponent = /** @class */ (function () {
    function GradeCollectComponent(activeRouter, http, router) {
        this.activeRouter = activeRouter;
        this.http = http;
        this.router = router;
        this.articles = [];
        this.listOfData = [];
        this.listOfColumn = [
            {
                title: '学生',
                compare: null,
                priority: false
            },
            {
                title: '学校',
                compare: null,
                priority: false
            },
            {
                title: '专业',
                compare: null,
                priority: false
            },
            {
                title: '班级',
                compare: null,
                priority: false
            },
            {
                title: '应获总学分',
                compare: function (a, b) { return a.shouldCredit - b.shouldCredit; },
                priority: false
            },
            {
                title: '已获总学分',
                compare: function (a, b) { return a.getCredit - b.getCredit; },
                priority: false
            },
            {
                title: '操作',
                compare: null,
                priority: false
            }
        ];
        this.showSchool = true;
        this.isSchool = true;
    }
    GradeCollectComponent.prototype.ngOnInit = function () {
        return __awaiter(this, void 0, void 0, function () {
            var Department;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!localStorage.getItem('department')) return [3 /*break*/, 2];
                        this.department = localStorage.getItem('department');
                        this.showSchool = false;
                        Department = new Parse.Query("Department");
                        return [4 /*yield*/, Department.get(this.department).then(function (res) {
                                if (res && res.get('school')) {
                                    _this.changeSchool(res.get('school')[0].id);
                                    _this.isSchool = false;
                                }
                                else {
                                    _this.changeSchool(res.id);
                                }
                            })];
                    case 1:
                        _a.sent();
                        _a.label = 2;
                    case 2: return [4 /*yield*/, this.getCompany(this.department).then(function (res) {
                            _this.searchAll();
                            if (_this.showSchool) {
                                _this.getSchool();
                            }
                        })];
                    case 3:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    GradeCollectComponent.prototype.getCompany = function (did) {
        return __awaiter(this, void 0, void 0, function () {
            var Department, department;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!did) return [3 /*break*/, 2];
                        Department = new Parse.Query('Department');
                        return [4 /*yield*/, Department.get(did)];
                    case 1:
                        department = _a.sent();
                        if (department && department.id) {
                            this.company = department.get('company').id;
                        }
                        return [3 /*break*/, 3];
                    case 2:
                        this.company = localStorage.getItem('company');
                        _a.label = 3;
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    GradeCollectComponent.prototype.getSchool = function () {
        var _this = this;
        var Department = new Parse.Query('Department');
        if (this.company == 'pPZbxElQQo') {
            Department.equalTo('category', 'erVPCmBAgt');
        }
        Department.equalTo('company', this.company);
        Department.find().then(function (res) {
            _this.schools = res;
        });
    };
    GradeCollectComponent.prototype.changeSchool = function (ev) {
        return __awaiter(this, void 0, void 0, function () {
            var SchoolMajor, schoolMajors;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!ev) {
                            this.major = null,
                                this.majors = [];
                            this.searchAll();
                            return [2 /*return*/];
                        }
                        SchoolMajor = new Parse.Query('SchoolMajor');
                        SchoolMajor.include('plan');
                        this.school = ev;
                        SchoolMajor.equalTo('school', ev);
                        return [4 /*yield*/, SchoolMajor.find()];
                    case 1:
                        schoolMajors = _a.sent();
                        if (schoolMajors && schoolMajors.length > 0) {
                            this.majors = schoolMajors;
                        }
                        return [2 /*return*/];
                }
            });
        });
    };
    GradeCollectComponent.prototype.changeMajors = function (ev) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                if (ev && ev.id) {
                    this.major = ev.id;
                }
                return [2 /*return*/];
            });
        });
    };
    GradeCollectComponent.prototype.searchStudent = function () {
    };
    GradeCollectComponent.prototype.searchAll = function (csql) {
        var _this = this;
        var baseurl = localStorage.getItem("NOVA_SERVERURL")?localStorage.getItem("NOVA_SERVERURL")+"api/novaql/select":localStorage.getItem("NOVA_SERVERURL")?localStorage.getItem("NOVA_SERVERURL")+"api/novaql/select":"https://server.fmode.cn/api/novaql/select";
        var sql;
        if (localStorage.getItem('department')) {
            console.log(localStorage.getItem('department'));
            var department = localStorage.getItem('department');
            if (!this.isSchool) {
                // 只查该助学中心的数据
                sql = csql ? csql : "select \n    \"PInfo\".\"uid\" as \"uid\",\n    \"PInfo\".\"user\" as \"user\",\n    \"PInfo\".\"school\" as \"school\",\n    \"PInfo\".\"major\" as \"major\",\n    \"PInfo\".\"class\" as \"class\",\n    \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n    \"getCredit\".\"tcredit\" as \"getCredit\"\n  from \n  (select\n    \"profile\".\"objectId\" as \"uid\",\n    \"profile\".\"name\" as \"user\",\n    \"department\".\"name\" as \"school\",\n    \"schoolMajor\".\"name\" as \"major\",\n    \"schoolMajor\".\"objectId\" as \"mid\",\n    \"schoolMajor\".\"plan\" as \"plan\",\n    \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n    \"schoolClass\".\"name\" as \"class\"\n  from \"Profile\" as \"profile\"\n  left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n  left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n  left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n  where \"profile\".\"company\" = '" + this.company + "' and \"profile\".\"center\" = '" + department + "')  as \"PInfo\"\n  left join \n  (SELECT \n    max(\"Credit\".\"uid\") as \"uid\",\n    sum(\n    case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n      > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n  from\n  (SELECT \n    \"R\".\"uid\" as \"uid\",\n    \"R\".\"lid\" as \"lid\",\n    \"R\".\"test\" as \"sid\",\n    \"R\".\"user\" as \"user\",\n    \"R\".\"credit\" as \"credit\",\n    round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n  from \n  (SELECT\n          max(\"profile\".\"name\")  as \"user\",\n          max(\"profile\".\"objectId\")  as \"uid\",\n          max(\"lesson\".\"objectId\") as \"lid\",\n       max(\"lesson\".\"credit\") as \"credit\",\n       max(\"lesson\".\"lessonTest\") as \"test\",\n          sum(\"record\".\"time\") as \"totalTime\",\n          sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n       from \"LessonRecord\" as \"record\"\n        left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n        left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n        left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n        left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n        left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n      where \"record\".\"company\" = '" + this.company + "'\n        group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n  left join \n  (select\n     count(1) as \"total\",\n     max(\"LessonArticle\".\"objectId\") as \"laid\",\n    max(\"LessonArticle\".\"lesson\") as \"lid\"\n   from \"LessonArticle\"\n   left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n   where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n   group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n   ) as \"Credit\"\n    left join (select \n     \"surveylog\".\"profile\" as \"uid\",\n     \"surveylog\".\"survey\" as \"sid\",\n     (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n   from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n   group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n        ";
            }
            else {
                sql = csql ? csql : "select \n    \"PInfo\".\"uid\" as \"uid\",\n    \"PInfo\".\"user\" as \"user\",\n    \"PInfo\".\"school\" as \"school\",\n    \"PInfo\".\"major\" as \"major\",\n    \"PInfo\".\"class\" as \"class\",\n    \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n    \"getCredit\".\"tcredit\" as \"getCredit\"\n  from \n  (select\n    \"profile\".\"objectId\" as \"uid\",\n    \"profile\".\"name\" as \"user\",\n    \"department\".\"name\" as \"school\",\n    \"schoolMajor\".\"name\" as \"major\",\n    \"schoolMajor\".\"objectId\" as \"mid\",\n    \"schoolMajor\".\"plan\" as \"plan\",\n    \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n    \"schoolClass\".\"name\" as \"class\"\n  from \"Profile\" as \"profile\"\n  left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n  left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n  left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n  where \"profile\".\"company\" = '" + this.company + "' and \"profile\".\"department\" = '" + department + "' )  as \"PInfo\"\n  left join \n  (SELECT \n    max(\"Credit\".\"uid\") as \"uid\",\n    sum(\n    case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n      > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n  from\n  (SELECT \n    \"R\".\"uid\" as \"uid\",\n    \"R\".\"lid\" as \"lid\",\n    \"R\".\"test\" as \"sid\",\n    \"R\".\"user\" as \"user\",\n    \"R\".\"credit\" as \"credit\",\n    round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n  from \n  (SELECT\n          max(\"profile\".\"name\")  as \"user\",\n          max(\"profile\".\"objectId\")  as \"uid\",\n          max(\"lesson\".\"objectId\") as \"lid\",\n       max(\"lesson\".\"credit\") as \"credit\",\n       max(\"lesson\".\"lessonTest\") as \"test\",\n          sum(\"record\".\"time\") as \"totalTime\",\n          sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n       from \"LessonRecord\" as \"record\"\n        left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n        left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n        left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n        left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n        left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n      where \"record\".\"company\" = '" + this.company + "'\n        group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n  left join \n  (select\n     count(1) as \"total\",\n     max(\"LessonArticle\".\"objectId\") as \"laid\",\n    max(\"LessonArticle\".\"lesson\") as \"lid\"\n   from \"LessonArticle\"\n   left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n   where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n   group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n   ) as \"Credit\"\n    left join (select \n     \"surveylog\".\"profile\" as \"uid\",\n     \"surveylog\".\"survey\" as \"sid\",\n     (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n   from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n   group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n        ";
            }
        }
        else {
            sql = csql ? csql : "select \n    \"PInfo\".\"uid\" as \"uid\",\n    \"PInfo\".\"user\" as \"user\",\n    \"PInfo\".\"school\" as \"school\",\n    \"PInfo\".\"major\" as \"major\",\n    \"PInfo\".\"class\" as \"class\",\n    \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n    \"getCredit\".\"tcredit\" as \"getCredit\"\n  from \n  (select\n    \"profile\".\"objectId\" as \"uid\",\n    \"profile\".\"name\" as \"user\",\n    \"department\".\"name\" as \"school\",\n    \"schoolMajor\".\"name\" as \"major\",\n    \"schoolMajor\".\"objectId\" as \"mid\",\n    \"schoolMajor\".\"plan\" as \"plan\",\n    \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n    \"schoolClass\".\"name\" as \"class\"\n  from \"Profile\" as \"profile\"\n  left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n  left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n  left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n  where \"profile\".\"company\" = '" + this.company + "') as \"PInfo\"\n  left join \n  (SELECT \n    max(\"Credit\".\"uid\") as \"uid\",\n    sum(\n    case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n      > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n  from\n  (SELECT \n    \"R\".\"uid\" as \"uid\",\n    \"R\".\"lid\" as \"lid\",\n    \"R\".\"test\" as \"sid\",\n    \"R\".\"user\" as \"user\",\n    \"R\".\"credit\" as \"credit\",\n    round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n  from \n  (SELECT\n          max(\"profile\".\"name\")  as \"user\",\n          max(\"profile\".\"objectId\")  as \"uid\",\n          max(\"lesson\".\"objectId\") as \"lid\",\n       max(\"lesson\".\"credit\") as \"credit\",\n       max(\"lesson\".\"lessonTest\") as \"test\",\n          sum(\"record\".\"time\") as \"totalTime\",\n          sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n       from \"LessonRecord\" as \"record\"\n        left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n        left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n        left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n        left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n        left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n      where \"record\".\"company\" = '" + this.company + "'\n        group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n  left join \n  (select\n     count(1) as \"total\",\n     max(\"LessonArticle\".\"objectId\") as \"laid\",\n    max(\"LessonArticle\".\"lesson\") as \"lid\"\n   from \"LessonArticle\"\n   left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n   where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n   group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n   ) as \"Credit\"\n    left join (select \n     \"surveylog\".\"profile\" as \"uid\",\n     \"surveylog\".\"survey\" as \"sid\",\n     (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n   from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n   group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n        ";
        }
        this.http.post(baseurl, { sql: sql }).subscribe(function (res) {
            if (res["code"] == 200 && res["data"]) {
                _this.listOfData = res["data"];
            }
        });
    };
    GradeCollectComponent.prototype.toDetail = function (uid) {
        this.router.navigate(['/masterol-doctor/grade-detail', { uid: uid }]);
    };
    // 查询
    GradeCollectComponent.prototype.search = function () {
        if (!this.school) {
            alert('请输入完整信息');
        }
        if (this.student && (!this.major || !this.school)) {
            alert('请输入完整信息');
        }
        var sql;
        if (localStorage.getItem('department')) {
            var department = localStorage.getItem('department');
            if (!this.isSchool) {
                // 助学中心
                if (this.school && !this.major) {
                    sql = "select \n          \"PInfo\".\"uid\" as \"uid\",\n          \"PInfo\".\"user\" as \"user\",\n          \"PInfo\".\"school\" as \"school\",\n          \"PInfo\".\"major\" as \"major\",\n          \"PInfo\".\"class\" as \"class\",\n          \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n          \"getCredit\".\"tcredit\" as \"getCredit\"\n        from \n        (select\n          \"profile\".\"objectId\" as \"uid\",\n          \"profile\".\"name\" as \"user\",\n          \"department\".\"name\" as \"school\",\n          \"schoolMajor\".\"name\" as \"major\",\n          \"schoolMajor\".\"objectId\" as \"mid\",\n          \"schoolMajor\".\"plan\" as \"plan\",\n          \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n          \"schoolClass\".\"name\" as \"class\"\n        from \"Profile\" as \"profile\"\n        left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n        left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n        left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n        where  \"profile\".\"company\" = '" + this.company + "' and \"profile\".\"center\" = '" + department + "') as \"PInfo\"\n        left join \n        (SELECT \n          max(\"Credit\".\"uid\") as \"uid\",\n          sum(\n          case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n            > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n        from\n        (SELECT \n          \"R\".\"uid\" as \"uid\",\n          \"R\".\"lid\" as \"lid\",\n          \"R\".\"test\" as \"sid\",\n          \"R\".\"user\" as \"user\",\n          \"R\".\"credit\" as \"credit\",\n          round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n        from \n        (SELECT\n                max(\"profile\".\"name\")  as \"user\",\n                max(\"profile\".\"objectId\")  as \"uid\",\n                max(\"lesson\".\"objectId\") as \"lid\",\n             max(\"lesson\".\"credit\") as \"credit\",\n             max(\"lesson\".\"lessonTest\") as \"test\",\n                sum(\"record\".\"time\") as \"totalTime\",\n                sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n             from \"LessonRecord\" as \"record\"\n              left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n              left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n              left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n              left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n              left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n            where \"record\".\"company\" = '" + this.company + "'\n              group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n        left join \n        (select\n           count(1) as \"total\",\n           max(\"LessonArticle\".\"objectId\") as \"laid\",\n          max(\"LessonArticle\".\"lesson\") as \"lid\"\n         from \"LessonArticle\"\n         left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n         where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n         group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n         ) as \"Credit\"\n          left join (select \n           \"surveylog\".\"profile\" as \"uid\",\n           \"surveylog\".\"survey\" as \"sid\",\n           (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n         from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n         group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n         ";
                }
                if (this.school && this.major && !this.student) {
                    sql = "select \n        \"PInfo\".\"uid\" as \"uid\",\n        \"PInfo\".\"user\" as \"user\",\n        \"PInfo\".\"school\" as \"school\",\n        \"PInfo\".\"major\" as \"major\",\n        \"PInfo\".\"class\" as \"class\",\n        \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n        \"getCredit\".\"tcredit\" as \"getCredit\"\n      from \n      (select\n        \"profile\".\"objectId\" as \"uid\",\n        \"profile\".\"name\" as \"user\",\n        \"department\".\"name\" as \"school\",\n        \"schoolMajor\".\"name\" as \"major\",\n        \"schoolMajor\".\"objectId\" as \"mid\",\n        \"schoolMajor\".\"plan\" as \"plan\",\n        \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n        \"schoolClass\".\"name\" as \"class\"\n      from \"Profile\" as \"profile\"\n      left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n      left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n      left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n      where  \"profile\".\"company\" = '" + this.company + "') and \"profile\".\"center\" '" + localStorage.getItem("department") + ")' and \"profile\".\"SchoolMajor\" = '" + this.major.id + "' as \"PInfo\"\n      left join \n      (SELECT \n        max(\"Credit\".\"uid\") as \"uid\",\n        sum(\n        case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n          > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n      from\n      (SELECT \n        \"R\".\"uid\" as \"uid\",\n        \"R\".\"lid\" as \"lid\",\n        \"R\".\"test\" as \"sid\",\n        \"R\".\"user\" as \"user\",\n        \"R\".\"credit\" as \"credit\",\n        round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n      from \n      (SELECT\n              max(\"profile\".\"name\")  as \"user\",\n              max(\"profile\".\"objectId\")  as \"uid\",\n              max(\"lesson\".\"objectId\") as \"lid\",\n            max(\"lesson\".\"credit\") as \"credit\",\n            max(\"lesson\".\"lessonTest\") as \"test\",\n              sum(\"record\".\"time\") as \"totalTime\",\n              sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n            from \"LessonRecord\" as \"record\"\n            left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n            left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n            left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n            left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n            left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n          where \"record\".\"company\" = '" + this.company + "'\n            group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n      left join \n      (select\n          count(1) as \"total\",\n          max(\"LessonArticle\".\"objectId\") as \"laid\",\n        max(\"LessonArticle\".\"lesson\") as \"lid\"\n        from \"LessonArticle\"\n        left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n        where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n        group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n        ) as \"Credit\"\n        left join (select \n          \"surveylog\".\"profile\" as \"uid\",\n          \"surveylog\".\"survey\" as \"sid\",\n          (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n        from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n        group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n        ";
                }
                if (this.school && this.major && this.student) {
                    sql = "select \n        \"PInfo\".\"uid\" as \"uid\",\n        \"PInfo\".\"user\" as \"user\",\n        \"PInfo\".\"school\" as \"school\",\n        \"PInfo\".\"major\" as \"major\",\n        \"PInfo\".\"class\" as \"class\",\n        \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n        \"getCredit\".\"tcredit\" as \"getCredit\"\n      from \n      (select\n        \"profile\".\"objectId\" as \"uid\",\n        \"profile\".\"name\" as \"user\",\n        \"department\".\"name\" as \"school\",\n        \"schoolMajor\".\"name\" as \"major\",\n        \"schoolMajor\".\"objectId\" as \"mid\",\n        \"schoolMajor\".\"plan\" as \"plan\",\n        \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n        \"schoolClass\".\"name\" as \"class\"\n      from \"Profile\" as \"profile\"\n      left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n      left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n      left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n      where  \"profile\".\"company\" = '" + this.company + "' and \"profile\".\"center\" = '" + localStorage.getItem("department") + "' and \"profile\".\"SchoolMajor\" = '" + this.major.id + "' and \"profile\".\"name\" = '" + this.student + "') as \"PInfo\"\n      left join \n      (SELECT \n        max(\"Credit\".\"uid\") as \"uid\",\n        sum(\n        case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n          > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n      from\n      (SELECT \n        \"R\".\"uid\" as \"uid\",\n        \"R\".\"lid\" as \"lid\",\n        \"R\".\"test\" as \"sid\",\n        \"R\".\"user\" as \"user\",\n        \"R\".\"credit\" as \"credit\",\n        round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n      from \n      (SELECT\n              max(\"profile\".\"name\")  as \"user\",\n              max(\"profile\".\"objectId\")  as \"uid\",\n              max(\"lesson\".\"objectId\") as \"lid\",\n            max(\"lesson\".\"credit\") as \"credit\",\n            max(\"lesson\".\"lessonTest\") as \"test\",\n              sum(\"record\".\"time\") as \"totalTime\",\n              sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n            from \"LessonRecord\" as \"record\"\n            left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n            left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n            left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n            left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n            left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n          where \"record\".\"company\" = '" + this.company + "'\n            group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n      left join \n      (select\n          count(1) as \"total\",\n          max(\"LessonArticle\".\"objectId\") as \"laid\",\n        max(\"LessonArticle\".\"lesson\") as \"lid\"\n        from \"LessonArticle\"\n        left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n        where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n        group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n        ) as \"Credit\"\n        left join (select \n          \"surveylog\".\"profile\" as \"uid\",\n          \"surveylog\".\"survey\" as \"sid\",\n          (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n        from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n        group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n        ";
                }
            }
            else {
                // 学校
                if (this.school && !this.major) {
                    sql = "select \n          \"PInfo\".\"uid\" as \"uid\",\n          \"PInfo\".\"user\" as \"user\",\n          \"PInfo\".\"school\" as \"school\",\n          \"PInfo\".\"major\" as \"major\",\n          \"PInfo\".\"class\" as \"class\",\n          \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n          \"getCredit\".\"tcredit\" as \"getCredit\"\n        from \n        (select\n          \"profile\".\"objectId\" as \"uid\",\n          \"profile\".\"name\" as \"user\",\n          \"department\".\"name\" as \"school\",\n          \"schoolMajor\".\"name\" as \"major\",\n          \"schoolMajor\".\"objectId\" as \"mid\",\n          \"schoolMajor\".\"plan\" as \"plan\",\n          \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n          \"schoolClass\".\"name\" as \"class\"\n        from \"Profile\" as \"profile\"\n        left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n        left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n        left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n        where  \"profile\".\"company\" = '" + this.company + "' and \"profile\".\"department\" = '" + this.school + "') as \"PInfo\"\n        left join \n        (SELECT \n          max(\"Credit\".\"uid\") as \"uid\",\n          sum(\n          case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n            > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n        from\n        (SELECT \n          \"R\".\"uid\" as \"uid\",\n          \"R\".\"lid\" as \"lid\",\n          \"R\".\"test\" as \"sid\",\n          \"R\".\"user\" as \"user\",\n          \"R\".\"credit\" as \"credit\",\n          round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n        from \n        (SELECT\n                max(\"profile\".\"name\")  as \"user\",\n                max(\"profile\".\"objectId\")  as \"uid\",\n                max(\"lesson\".\"objectId\") as \"lid\",\n             max(\"lesson\".\"credit\") as \"credit\",\n             max(\"lesson\".\"lessonTest\") as \"test\",\n                sum(\"record\".\"time\") as \"totalTime\",\n                sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n             from \"LessonRecord\" as \"record\"\n              left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n              left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n              left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n              left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n              left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n            where \"record\".\"company\" = '" + this.company + "'\n              group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n        left join \n        (select\n           count(1) as \"total\",\n           max(\"LessonArticle\".\"objectId\") as \"laid\",\n          max(\"LessonArticle\".\"lesson\") as \"lid\"\n         from \"LessonArticle\"\n         left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n         where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n         group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n         ) as \"Credit\"\n          left join (select \n           \"surveylog\".\"profile\" as \"uid\",\n           \"surveylog\".\"survey\" as \"sid\",\n           (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n         from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n         group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n         ";
                }
                if (this.school && this.major && !this.student) {
                    sql = "select \n        \"PInfo\".\"uid\" as \"uid\",\n        \"PInfo\".\"user\" as \"user\",\n        \"PInfo\".\"school\" as \"school\",\n        \"PInfo\".\"major\" as \"major\",\n        \"PInfo\".\"class\" as \"class\",\n        \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n        \"getCredit\".\"tcredit\" as \"getCredit\"\n      from \n      (select\n        \"profile\".\"objectId\" as \"uid\",\n        \"profile\".\"name\" as \"user\",\n        \"department\".\"name\" as \"school\",\n        \"schoolMajor\".\"name\" as \"major\",\n        \"schoolMajor\".\"objectId\" as \"mid\",\n        \"schoolMajor\".\"plan\" as \"plan\",\n        \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n        \"schoolClass\".\"name\" as \"class\"\n      from \"Profile\" as \"profile\"\n      left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n      left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n      left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n      where  \"profile\".\"company\" = '" + this.company + "' and \"profile\".\"department\" = '" + this.school + "' and \"profile\".\"SchoolMajor\" = '" + this.major.id + "') as \"PInfo\"\n      left join \n      (SELECT \n        max(\"Credit\".\"uid\") as \"uid\",\n        sum(\n        case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n          > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n      from\n      (SELECT \n        \"R\".\"uid\" as \"uid\",\n        \"R\".\"lid\" as \"lid\",\n        \"R\".\"test\" as \"sid\",\n        \"R\".\"user\" as \"user\",\n        \"R\".\"credit\" as \"credit\",\n        round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n      from \n      (SELECT\n              max(\"profile\".\"name\")  as \"user\",\n              max(\"profile\".\"objectId\")  as \"uid\",\n              max(\"lesson\".\"objectId\") as \"lid\",\n            max(\"lesson\".\"credit\") as \"credit\",\n            max(\"lesson\".\"lessonTest\") as \"test\",\n              sum(\"record\".\"time\") as \"totalTime\",\n              sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n            from \"LessonRecord\" as \"record\"\n            left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n            left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n            left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n            left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n            left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n          where \"record\".\"company\" = '" + this.company + "'\n            group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n      left join \n      (select\n          count(1) as \"total\",\n          max(\"LessonArticle\".\"objectId\") as \"laid\",\n        max(\"LessonArticle\".\"lesson\") as \"lid\"\n        from \"LessonArticle\"\n        left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n        where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n        group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n        ) as \"Credit\"\n        left join (select \n          \"surveylog\".\"profile\" as \"uid\",\n          \"surveylog\".\"survey\" as \"sid\",\n          (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n        from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n        group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n        ";
                }
                if (this.school && this.major && this.student) {
                    sql = "select \n        \"PInfo\".\"uid\" as \"uid\",\n        \"PInfo\".\"user\" as \"user\",\n        \"PInfo\".\"school\" as \"school\",\n        \"PInfo\".\"major\" as \"major\",\n        \"PInfo\".\"class\" as \"class\",\n        \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n        \"getCredit\".\"tcredit\" as \"getCredit\"\n      from \n      (select\n        \"profile\".\"objectId\" as \"uid\",\n        \"profile\".\"name\" as \"user\",\n        \"department\".\"name\" as \"school\",\n        \"schoolMajor\".\"name\" as \"major\",\n        \"schoolMajor\".\"objectId\" as \"mid\",\n        \"schoolMajor\".\"plan\" as \"plan\",\n        \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n        \"schoolClass\".\"name\" as \"class\"\n      from \"Profile\" as \"profile\"\n      left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n      left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n      left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n      where  \"profile\".\"company\" = '" + this.company + "' and \"profile\".\"department\" = '" + this.school + "' and \"profile\".\"SchoolMajor\" = '" + this.major.id + "' and \"profile\".\"name\" = '" + this.student + "') as \"PInfo\"\n      left join \n      (SELECT \n        max(\"Credit\".\"uid\") as \"uid\",\n        sum(\n        case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n          > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n      from\n      (SELECT \n        \"R\".\"uid\" as \"uid\",\n        \"R\".\"lid\" as \"lid\",\n        \"R\".\"test\" as \"sid\",\n        \"R\".\"user\" as \"user\",\n        \"R\".\"credit\" as \"credit\",\n        round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n      from \n      (SELECT\n              max(\"profile\".\"name\")  as \"user\",\n              max(\"profile\".\"objectId\")  as \"uid\",\n              max(\"lesson\".\"objectId\") as \"lid\",\n            max(\"lesson\".\"credit\") as \"credit\",\n            max(\"lesson\".\"lessonTest\") as \"test\",\n              sum(\"record\".\"time\") as \"totalTime\",\n              sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n            from \"LessonRecord\" as \"record\"\n            left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n            left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n            left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n            left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n            left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n          where \"record\".\"company\" = '" + this.company + "'\n            group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n      left join \n      (select\n          count(1) as \"total\",\n          max(\"LessonArticle\".\"objectId\") as \"laid\",\n        max(\"LessonArticle\".\"lesson\") as \"lid\"\n        from \"LessonArticle\"\n        left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n        where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n        group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n        ) as \"Credit\"\n        left join (select \n          \"surveylog\".\"profile\" as \"uid\",\n          \"surveylog\".\"survey\" as \"sid\",\n          (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n        from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n        group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n        ";
                }
            }
        }
        else {
            // 总部
            if (this.school && !this.major) {
                sql = "select \n        \"PInfo\".\"uid\" as \"uid\",\n        \"PInfo\".\"user\" as \"user\",\n        \"PInfo\".\"school\" as \"school\",\n        \"PInfo\".\"major\" as \"major\",\n        \"PInfo\".\"class\" as \"class\",\n        \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n        \"getCredit\".\"tcredit\" as \"getCredit\"\n      from \n      (select\n        \"profile\".\"objectId\" as \"uid\",\n        \"profile\".\"name\" as \"user\",\n        \"department\".\"name\" as \"school\",\n        \"schoolMajor\".\"name\" as \"major\",\n        \"schoolMajor\".\"objectId\" as \"mid\",\n        \"schoolMajor\".\"plan\" as \"plan\",\n        \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n        \"schoolClass\".\"name\" as \"class\"\n      from \"Profile\" as \"profile\"\n      left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n      left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n      left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n      where  \"profile\".\"company\" = '" + this.company + "') and \"profile\".\"department\" = '" + this.school + "' as \"PInfo\"\n      left join \n      (SELECT \n        max(\"Credit\".\"uid\") as \"uid\",\n        sum(\n        case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n          > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n      from\n      (SELECT \n        \"R\".\"uid\" as \"uid\",\n        \"R\".\"lid\" as \"lid\",\n        \"R\".\"test\" as \"sid\",\n        \"R\".\"user\" as \"user\",\n        \"R\".\"credit\" as \"credit\",\n        round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n      from \n      (SELECT\n              max(\"profile\".\"name\")  as \"user\",\n              max(\"profile\".\"objectId\")  as \"uid\",\n              max(\"lesson\".\"objectId\") as \"lid\",\n           max(\"lesson\".\"credit\") as \"credit\",\n           max(\"lesson\".\"lessonTest\") as \"test\",\n              sum(\"record\".\"time\") as \"totalTime\",\n              sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n           from \"LessonRecord\" as \"record\"\n            left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n            left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n            left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n            left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n            left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n          where \"record\".\"company\" = '" + this.company + "'\n            group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n      left join \n      (select\n         count(1) as \"total\",\n         max(\"LessonArticle\".\"objectId\") as \"laid\",\n        max(\"LessonArticle\".\"lesson\") as \"lid\"\n       from \"LessonArticle\"\n       left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n       where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n       group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n       ) as \"Credit\"\n        left join (select \n         \"surveylog\".\"profile\" as \"uid\",\n         \"surveylog\".\"survey\" as \"sid\",\n         (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n       from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n       group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n       ";
            }
            if (this.school && this.major && !this.student) {
                sql = "select \n      \"PInfo\".\"uid\" as \"uid\",\n      \"PInfo\".\"user\" as \"user\",\n      \"PInfo\".\"school\" as \"school\",\n      \"PInfo\".\"major\" as \"major\",\n      \"PInfo\".\"class\" as \"class\",\n      \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n      \"getCredit\".\"tcredit\" as \"getCredit\"\n    from \n    (select\n      \"profile\".\"objectId\" as \"uid\",\n      \"profile\".\"name\" as \"user\",\n      \"department\".\"name\" as \"school\",\n      \"schoolMajor\".\"name\" as \"major\",\n      \"schoolMajor\".\"objectId\" as \"mid\",\n      \"schoolMajor\".\"plan\" as \"plan\",\n      \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n      \"schoolClass\".\"name\" as \"class\"\n    from \"Profile\" as \"profile\"\n    left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n    left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n    left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n    where  \"profile\".\"company\" = '" + this.company + "') and \"profile\".\"department\" = '" + this.school + "' and \"profile\".\"SchoolMajor\" = '" + this.major.id + "' as \"PInfo\"\n    left join \n    (SELECT \n      max(\"Credit\".\"uid\") as \"uid\",\n      sum(\n      case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n        > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n    from\n    (SELECT \n      \"R\".\"uid\" as \"uid\",\n      \"R\".\"lid\" as \"lid\",\n      \"R\".\"test\" as \"sid\",\n      \"R\".\"user\" as \"user\",\n      \"R\".\"credit\" as \"credit\",\n      round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n    from \n    (SELECT\n            max(\"profile\".\"name\")  as \"user\",\n            max(\"profile\".\"objectId\")  as \"uid\",\n            max(\"lesson\".\"objectId\") as \"lid\",\n          max(\"lesson\".\"credit\") as \"credit\",\n          max(\"lesson\".\"lessonTest\") as \"test\",\n            sum(\"record\".\"time\") as \"totalTime\",\n            sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n          from \"LessonRecord\" as \"record\"\n          left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n          left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n          left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n          left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n          left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n        where \"record\".\"company\" = '" + this.company + "'\n          group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n    left join \n    (select\n        count(1) as \"total\",\n        max(\"LessonArticle\".\"objectId\") as \"laid\",\n      max(\"LessonArticle\".\"lesson\") as \"lid\"\n      from \"LessonArticle\"\n      left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n      where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n      group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n      ) as \"Credit\"\n      left join (select \n        \"surveylog\".\"profile\" as \"uid\",\n        \"surveylog\".\"survey\" as \"sid\",\n        (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n      from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n      group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n      ";
            }
            if (this.school && this.major && this.student) {
                sql = "select \n      \"PInfo\".\"uid\" as \"uid\",\n      \"PInfo\".\"user\" as \"user\",\n      \"PInfo\".\"school\" as \"school\",\n      \"PInfo\".\"major\" as \"major\",\n      \"PInfo\".\"class\" as \"class\",\n      \"PInfo\".\"shouldCredit\" as \"shouldCredit\",\n      \"getCredit\".\"tcredit\" as \"getCredit\"\n    from \n    (select\n      \"profile\".\"objectId\" as \"uid\",\n      \"profile\".\"name\" as \"user\",\n      \"department\".\"name\" as \"school\",\n      \"schoolMajor\".\"name\" as \"major\",\n      \"schoolMajor\".\"objectId\" as \"mid\",\n      \"schoolMajor\".\"plan\" as \"plan\",\n      \"schoolMajor\".\"totalCredit\" as \"shouldCredit\",\n      \"schoolClass\".\"name\" as \"class\"\n    from \"Profile\" as \"profile\"\n    left join \"Department\" as \"department\" on \"department\".\"objectId\" = \"profile\".\"department\" \n    left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n    left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n    where  \"profile\".\"company\" = '" + this.company + "') and \"profile\".\"department\" = '" + this.school + "' and \"profile\".\"SchoolMajor\" = '" + this.major.id + "' and \"profile\".\"name\" = '" + this.student + "' as \"PInfo\"\n    left join \n    (SELECT \n      max(\"Credit\".\"uid\") as \"uid\",\n      sum(\n      case when (\"Credit\".\"videograde\" * 0.4) + (case when \"TestGread\".\"totalScore\" is not null then (\"TestGread\".\"totalScore\" * 0.6) else 0 end) \n        > 60 then \"Credit\".\"credit\" else 0 end) as \"tcredit\"\n    from\n    (SELECT \n      \"R\".\"uid\" as \"uid\",\n      \"R\".\"lid\" as \"lid\",\n      \"R\".\"test\" as \"sid\",\n      \"R\".\"user\" as \"user\",\n      \"R\".\"credit\" as \"credit\",\n      round((case when \"totalCount\".\"total\" is not null then (\"R\".\"downCount\"*100 / \"totalCount\".\"total\") else 0 end ),0) as \"videograde\"\t\n    from \n    (SELECT\n            max(\"profile\".\"name\")  as \"user\",\n            max(\"profile\".\"objectId\")  as \"uid\",\n            max(\"lesson\".\"objectId\") as \"lid\",\n          max(\"lesson\".\"credit\") as \"credit\",\n          max(\"lesson\".\"lessonTest\") as \"test\",\n            sum(\"record\".\"time\") as \"totalTime\",\n            sum(case when \"record\".\"status\" = 2  then 1 else 0 end) as \"downCount\"\n          from \"LessonRecord\" as \"record\"\n          left join \"Profile\" as \"profile\" on \"profile\".\"objectId\" = \"record\".\"user\"\n          left join \"Department\" as \"Department\" on \"Department\".\"objectId\" = \"record\".\"department\"\n          left join \"SchoolMajor\" as \"schoolMajor\" on \"schoolMajor\".\"objectId\" = \"profile\".\"SchoolMajor\"\n          left join \"SchoolClass\" as \"schoolClass\" on \"schoolClass\".\"objectId\" = \"profile\".\"schoolClass\"\n          left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"record\".\"lesson\"\n        where \"record\".\"company\" = '" + this.company + "'\n          group by \"record\".\"user\", \"record\".\"lesson\") as \"R\"\n    left join \n    (select\n        count(1) as \"total\",\n        max(\"LessonArticle\".\"objectId\") as \"laid\",\n      max(\"LessonArticle\".\"lesson\") as \"lid\"\n      from \"LessonArticle\"\n      left join \"Lesson\" as \"lesson\" on \"lesson\".\"objectId\" = \"LessonArticle\".\"lesson\"\n      where \"LessonArticle\".\"parent\" is not null and \"LessonArticle\".\"company\" = '" + this.company + "'\n      group by \"LessonArticle\".\"lesson\") as \"totalCount\" on \"totalCount\".\"lid\" = \"R\".\"lid\"\n      ) as \"Credit\"\n      left join (select \n        \"surveylog\".\"profile\" as \"uid\",\n        \"surveylog\".\"survey\" as \"sid\",\n        (case when  \"surveylog\".\"grade\" is not null then \"surveylog\".\"grade\" else 0  end ) as \"totalScore\"\n      from \"SurveyLog\" as \"surveylog\" where \"surveylog\".\"company\" = '" + this.company + "') as \"TestGread\" on \"TestGread\".\"uid\" = \"Credit\".\"uid\" and \"TestGread\".\"sid\" = \"Credit\".\"sid\"\n      group by \"Credit\".\"uid\") as \"getCredit\" on \"getCredit\".\"uid\" = \"PInfo\".\"uid\"\n      ";
            }
        }
        this.searchAll(sql);
    };
    GradeCollectComponent = __decorate([
        core_1.Component({
            selector: 'app-grade-collect',
            templateUrl: './grade-collect.component.html',
            styleUrls: ['./grade-collect.component.scss']
        })
    ], GradeCollectComponent);
    return GradeCollectComponent;
}());
exports.GradeCollectComponent = GradeCollectComponent;
